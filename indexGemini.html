<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¾³é–€ç¶­ä¿®å ±å·¥åŠ©æ‰‹ - äº’å‹•ç·¨è¼¯å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .recording-active { animation: pulse 1.5s infinite; background-color: #ef4444 !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        table input { width: 100%; border: none; background: transparent; padding: 6px; font-size: 13px; font-weight: 600; }
        table input:focus { background: #f0f9ff; outline: none; border-radius: 4px; box-shadow: inset 0 0 0 1px #bae6fd; }
        .custom-scrollbar::-webkit-scrollbar { height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 p-2 md:p-6">
    <div class="max-w-full mx-auto space-y-4">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 flex flex-col items-center justify-center min-h-[180px]">
                <button id="micBtn" class="w-20 h-20 bg-blue-600 text-white rounded-full shadow-xl flex items-center justify-center mb-3">
                    <span id="micIcon" class="text-3xl">ğŸ¤</span>
                </button>
                <p class="font-bold text-slate-700 text-sm text-center">æ’³ä¸€ä¸‹é–‹å§‹éŒ„éŸ³<br><span class="text-[10px] font-normal text-slate-400 text-center">è¬›å®Œå¾Œè«‹å†æ’³ä¸€ä¸‹çµæŸ</span></p>
            </div>
            <div class="lg:col-span-3 bg-white p-6 rounded-3xl shadow-sm border border-slate-200 flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <label class="text-[11px] font-black text-blue-600 uppercase tracking-widest italic">ğŸ”Š å¸«å‚…éŒ„éŸ³å³æ™‚åŸæ–‡</label>
                    <span id="statusTag" class="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-400 font-bold">STANDBY</span>
                </div>
                <div id="rawDisplay" class="text-slate-800 text-lg leading-relaxed flex-grow p-4 bg-slate-50 rounded-2xl border border-dashed border-slate-200 overflow-y-auto max-h-[100px]">
                    ç­‰å¾…éŒ„éŸ³... (ç¯„ä¾‹ï¼šã€Œå ¯ï¼Œ7620ï¼Œå…«é»ä¹æ”¶å–®å–º 16 æ¨“æ—©æœƒã€‚ã€)
                </div>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="p-5 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
                <h2 class="font-black text-xl text-slate-900">ğŸ“‹ Excel æ•¸æ“šç·¨è¼¯é è¦½ (18 æ¬„)</h2>
                <div class="bg-slate-50 px-6 py-3 rounded-2xl border border-slate-200">
                    <span class="text-xs font-bold text-slate-500 uppercase">ä»Šæ—¥ç´¯è¨ˆæ™‚æ•¸ï¼š</span>
                    <span id="totalHours" class="text-3xl font-black text-rose-600 tracking-tighter">0.0</span>
                    <span class="text-xs font-bold text-slate-500"> / 7.0 HR</span>
                </div>
            </div>
            <div class="overflow-x-auto custom-scrollbar">
                <table class="w-full text-left border-collapse min-w-[1600px]">
                    <thead class="bg-slate-50 text-slate-500 text-[11px] uppercase font-black tracking-wider">
                        <tr>
                            <th class="p-4 border-b">#</th><th class="p-4 border-b">æ—¥æœŸ</th><th class="p-4 border-b">çµ„åˆ¥</th>
                            <th class="p-4 border-b">å“¡å·¥ç·¨è™Ÿ</th><th class="p-4 border-b text-blue-600 bg-blue-50/30">å§“å</th>
                            <th class="p-4 border-b">æ›´</th><th class="p-4 border-b">å·¥å–®è™Ÿç¢¼</th><th class="p-4 border-b">éƒ¨é–€</th>
                            <th class="p-4 border-b">å·¥ä½œåˆ†é¡</th><th class="p-4 border-b text-blue-600 bg-blue-50/30">å…§å®¹</th>
                            <th class="p-4 border-b text-blue-600 bg-blue-50/30">åœ°é»</th><th class="p-4 border-b bg-amber-50 text-amber-700">æ¥å–®æ™‚é–“(Anchor)</th>
                            <th class="p-4 border-b">é–‹å§‹æ™‚é–“</th><th class="p-4 border-b">å®Œæˆæ™‚é–“</th><th class="p-4 border-b">ç‹€æ…‹</th>
                            <th class="p-4 border-b">OT</th><th class="p-4 border-b">Response</th><th class="p-4 border-b">Resolution</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 pb-12">
            <button onclick="copyToExcel()" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-5 rounded-3xl font-black shadow-lg active:scale-95 text-xl flex items-center justify-center gap-3">
                <span>ğŸ“‹</span> è¤‡è£½åˆ° Excel (Tab æ ¼å¼)
            </button>
            <button onclick="addNewRow()" class="bg-white text-slate-700 px-10 py-5 rounded-3xl font-black border border-slate-200 shadow-sm active:scale-95">â• åŠ æ–°å–®</button>
        </div>
    </div>

    <script>
        const cols = ["id", "date", "group", "empId", "name", "shift", "woNo", "dept", "type", "content", "location", "orderTime", "startTime", "endTime", "status", "ot", "responseTime", "resTime"];
        let rowData = [{ id: 1, date: new Date().toISOString().split('T')[0], group: "BD", empId: "", name: "", shift: "08:45:00", woNo: "", dept: "å·¥ç¨‹", type: "CMBD", content: "", location: "", orderTime: "", startTime: "", endTime: "", status: "å®Œæˆ", ot: "No", responseTime: "00:05:00", resTime: "" }];

        function renderTable() {
            const body = document.getElementById('tableBody');
            body.innerHTML = rowData.map((row, idx) => `
                <tr class="hover:bg-slate-50/80">
                    <td class="p-2 border-r text-center font-bold text-slate-300">${row.id}</td>
                    ${cols.slice(1).map(c => `<td class="p-1 border-r ${c==='orderTime'?'bg-amber-50/30':''}"><input type="text" value="${row[c] || ''}" onchange="updateData(${idx}, '${c}', this.value)"></td>`).join('')}
                </tr>`).join('');
            calcTotal();
        }

        function updateData(idx, c, v) {
            rowData[idx][c] = v;
            if (c === 'orderTime' && v.includes(':')) {
                let [h, m] = v.split(':').map(Number);
                let sM = m + 5;
                let sH = h + Math.floor(sM/60);
                rowData[idx]['startTime'] = `${String(sH).padStart(2,'0')}:${String(sM%60).padStart(2,'0')}:00`;
                rowData[idx]['responseTime'] = "00:05:00";
                if(!rowData[idx]['endTime']) rowData[idx]['endTime'] = `${String(sH+1).padStart(2,'0')}:${String(sM%60).padStart(2,'0')}:00`;
                renderTable();
            }
            calcTotal();
        }

        function calcTotal() {
            let total = 0;
            rowData.forEach(r => {
                if (r.startTime && r.endTime) {
                    let s = new Date(`2000/01/01 ${r.startTime}`).getTime();
                    let e = new Date(`2000/01/01 ${r.endTime}`).getTime();
                    if (e > s) {
                        let d = (e - s) / 1000 / 60;
                        total += d / 60;
                        r.resTime = Math.floor(d/60).toString().padStart(2,'0') + ":" + (d%60).toString().padStart(2,'0') + ":00";
                    }
                }
            });
            const d = document.getElementById('totalHours');
            d.innerText = total.toFixed(1);
            d.className = total >= 7 ? "text-3xl font-black text-emerald-600" : "text-3xl font-black text-rose-600";
        }

        function addNewRow() {
            const last = rowData[rowData.length - 1];
            rowData.push({ ...last, id: rowData.length + 1, content: "", location: "", orderTime: "", startTime: "", endTime: "", resTime: "" });
            renderTable();
        }

        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (Speech) {
            const rec = new Speech();
            rec.lang = 'zh-HK'; rec.continuous = true; rec.interimResults = true;
            let isRec = false;
            document.getElementById('micBtn').onclick = () => { if (isRec) rec.stop(); else rec.start(); };
            rec.onstart = () => { isRec = true; document.getElementById('micBtn').classList.add('recording-active'); document.getElementById('statusTag').innerText="REC"; };
            rec.onresult = (e) => {
                let t = Array.from(e.results).map(r => r[0].transcript).join('');
                document.getElementById('rawDisplay').innerText = t;
                let r = rowData[rowData.length - 1];
                if (t.match(/é¤é£²|FB|F&B/i)) r.dept = "F&B"; else r.dept = "å·¥ç¨‹";
                const jobs = ["åŸ·æ²¹", "è£œæ°´æ³¥", "æ¼æ°´", "æ›ç‡ˆ", "æ—©æœƒ"];
                jobs.forEach(j => { if (t.includes(j)) r.content = j; });
                const loc = t.match(/(\d+)\s*(æ¨“|f|å­—æ¨“|æˆ¿)/i); if (loc) r.location = loc[0];
                const tm = t.match(/(\d{1,2})[:é»](\d{1,2}|åŠ|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]|[\d])/);
                if (tm) {
                    let hh = tm[1].padStart(2,'0'), mm = tm[2] === "åŠ" ? "30" : (isNaN(tm[2]) ? "00" : tm[2].padStart(2,'0'));
                    updateData(rowData.length - 1, 'orderTime', `${hh}:${mm}:00`);
                }
                renderTable();
            };
            rec.onend = () => { isRec = false; document.getElementById('micBtn').classList.remove('recording-active'); document.getElementById('statusTag').innerText="STANDBY"; };
        }

        function copyToExcel() {
            let tsv = rowData.map(r => cols.map(c => r[c] || "").join("\t")).join("\n");
            navigator.clipboard.writeText(tsv).then(() => alert("âœ… å·²è¤‡è£½ï¼å» Excel æ’³ Ctrl+V è²¼ä¸Šã€‚"));
        }
        renderTable();
    </script>
</body>
</html>
