<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å ±å·¥åŠ©æ‰‹ - PC ç‰ˆ v1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .recording-active { animation: pulse 1.2s infinite; background-color: #ef4444 !important; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        body { font-size: 18px; font-family: -apple-system, sans-serif; }
        input { font-size: 20px !important; font-weight: 700 !important; border-radius: 8px; padding: 6px 12px; border: 2px solid #cbd5e1; width: 100%; }
        input:focus { border-color: #3b82f6; background-color: #f8fafc; outline: none; }
        .card { background: white; border-radius: 35px; border: 4px solid #e2e8f0; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-slate-100 p-4 md:p-8">
    <div class="max-w-7xl mx-auto space-y-6">
        
        <div class="bg-amber-50 border-l-8 border-amber-500 p-6 rounded-2xl">
            <h3 class="text-2xl font-black text-amber-900 mb-2 underline">âš ï¸ å ±å·¥è²¬ä»»æé†’ (Supervisor/Tech Only)</h3>
            <p class="text-amber-800 font-bold text-lg">AI èªéŸ³è­˜åˆ¥åƒ…ä½œå¡«è¡¨è¼”åŠ©ã€‚è¤‡è£½åˆ° Excel å‰ï¼Œè«‹å‹™å¿…æ‰‹å‹•æª¢æŸ¥æ‰€æœ‰æ™‚é–“ã€å…§å®¹åŠåœ°é»ï¼</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <div class="lg:col-span-1 card p-10 flex flex-col items-center justify-center bg-white">
                <button id="micBtn" class="w-36 h-36 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center mb-6 active:scale-90 transition-all">
                    <span id="micIcon" class="text-7xl">ğŸ¤</span>
                </button>
                <p id="micText" class="font-black text-2xl text-slate-700">æ’³ä¸€ä¸‹éŒ„éŸ³</p>
            </div>
            
            <div class="lg:col-span-3 card p-8 bg-white">
                <label class="text-blue-600 font-black text-xl flex items-center gap-2 mb-3">
                    <span class="w-4 h-4 bg-blue-600 rounded-full italic"></span> èªéŸ³åŸæ–‡ (å¯ç›´æ¥ä¿®æ”¹)ï¼š
                </label>
                <div id="rawDisplay" class="text-3xl font-bold leading-relaxed p-6 bg-slate-50 rounded-3xl border-4 border-dashed border-slate-200 min-h-[160px] text-slate-800" contenteditable="true">
                    ç­‰å¾…ä¸­... (ä¾‹ï¼š12é»åŠå»1æ¨“ç¿ è¯æ•´å˜¢ï¼Œåšå·¦ä¸€å€‹åŠé˜)
                </div>
            </div>
        </div>

        <div class="card overflow-hidden bg-white">
            <div class="p-8 bg-slate-50 border-b-4 flex justify-between items-center">
                <h2 class="font-black text-4xl text-slate-800 italic uppercase">Workorder Dashboard</h2>
                <div class="text-right bg-white px-10 py-5 rounded-3xl border-4 border-blue-100">
                    <span class="text-sm font-black text-slate-400 block tracking-widest">ä»Šæ—¥ç´¯è¨ˆ (HR)</span>
                    <span id="totalHours" class="text-6xl font-black text-rose-600 tracking-tighter">0.0</span>
                    <span class="text-2xl font-bold text-slate-400">/ 7.0</span>
                </div>
            </div>
            
            <div class="p-6 overflow-x-auto">
                <table class="w-full border-separate border-spacing-y-8">
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 pb-24">
            <button onclick="copyToExcel()" class="md:col-span-2 bg-emerald-600 text-white py-12 rounded-[40px] font-black shadow-2xl text-5xl active:scale-95 transition-all">
                ğŸ“‹ è¤‡è£½ 18 æ¬„è³‡æ–™
            </button>
            <button onclick="addNewRow()" class="bg-slate-800 text-white py-12 rounded-[40px] font-black text-3xl active:scale-95 transition-all">
                â• åŠ æ–°å–®
            </button>
        </div>
    </div>

    <script>
        // 2026 æ˜Ÿéš›é…’åº—æ•¸æ“šåº« (ä¿®æ­£ç‰ˆ)
        const STAR_MAP = [
            { key: 'Passion', loc: 'Passion', dept: 'F&B' },
            { key: 'ç¿ è¯', loc: '1/F ç¿ è¯é¤å»³', dept: 'F&B' },
            { key: 'æœ‰é£Ÿè¾°', loc: '1/F æœ‰é£Ÿè¾°', dept: 'F&B' },
            { key: 'çå‘³è»’', loc: '1/F çå‘³è»’', dept: 'F&B' },
            { key: 'ä¸¹æ¡‚', loc: '2/F ä¸¹æ¡‚è»’', dept: 'F&B' },
            { key: 'çæ·®', loc: '3/F çæ·®é–£', dept: 'F&B' },
            { key: 'é•·å‹', loc: '3/F é•·å‹åŠ', dept: 'F&B' },
            { key: 'é¢¨å‘³', loc: '5/F é¢¨å‘³å±…', dept: 'F&B' },
            { key: 'å¤©å³°', loc: '6/F å¤©å³°è»’', dept: 'F&B' },
            { key: 'å”æˆ', loc: '10/F å”æˆç«é‹', dept: 'F&B' },
            { key: 'å“å‘³åŠ', loc: '16/F å“å‘³åŠ', dept: 'F&B' },
            { key: 'å“å‘³å§', loc: '16/F å“å‘³å§', dept: 'F&B' },
            { key: 'æ³³æ± ', loc: '17/F æ³³æ± åŠå¥èº«ä¸­å¿ƒ', dept: 'front office' },
            { key: 'Gym', loc: '17/F æ³³æ± åŠå¥èº«ä¸­å¿ƒ', dept: 'front office' },
            { key: 'æˆ¿', loc: 'å®¢æˆ¿', dept: 'Housekeeping' }
        ];

        let rowData = [{ id: 1, date: new Date().toISOString().split('T')[0], group: "BD", empId: "7620", name: "å ¯", shift: "08:45:00", woNo: "", dept: "å·¥ç¨‹", type: "CMBD", content: "", location: "", orderTime: "", startTime: "", endTime: "", status: "å®Œæˆ", ot: "No", responseTime: "00:05:00", resTime: "" }];

        function renderTable() {
            const body = document.getElementById('tableBody');
            body.innerHTML = rowData.map((row, i) => `
                <tr class="bg-white border-4 border-slate-200 rounded-[40px] shadow-sm overflow-hidden">
                    <td class="p-8">
                        <div class="flex justify-between items-center mb-6">
                            <span class="bg-blue-600 text-white px-6 py-2 rounded-full font-black text-xl uppercase tracking-widest">Order #${row.id}</span>
                            <button onclick="deleteRow(${i})" class="text-rose-500 font-bold text-xl hover:underline italic">ğŸ—‘ï¸ Delete Row</button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                            <div class="space-y-1"><label class="text-xs font-black text-slate-400 uppercase">éƒ¨é–€ Dept</label><input type="text" value="${row.dept}" onchange="update(${i}, 'dept', this.value)"></div>
                            <div class="space-y-1"><label class="text-xs font-black text-amber-500 uppercase underline">æ¥å–® Order (Anchor)</label><input type="text" value="${row.orderTime}" placeholder="HH:MM" onchange="update(${i}, 'orderTime', this.value)" class="bg-amber-50 border-amber-200"></div>
                            <div class="space-y-1"><label class="text-xs font-black text-slate-400 uppercase">é–‹å§‹ Start</label><input type="text" value="${row.startTime}" onchange="update(${i}, 'startTime', this.value)"></div>
                            <div class="space-y-1"><label class="text-xs font-black text-slate-400 uppercase">å®Œæˆ End</label><input type="text" value="${row.endTime}" onchange="update(${i}, 'endTime', this.value)"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-blue-50 p-6 rounded-3xl border-2 border-blue-100">
                                <label class="block text-sm font-black text-blue-600 mb-2 italic">ğŸ› ï¸ å·¥ä½œå…§å®¹ Content</label>
                                <input type="text" value="${row.content}" onchange="update(${i}, 'content', this.value)" class="bg-transparent border-none text-3xl font-black text-blue-900 focus:ring-0">
                            </div>
                            <div class="bg-emerald-50 p-6 rounded-3xl border-2 border-emerald-100">
                                <label class="block text-sm font-black text-emerald-600 mb-2 italic">ğŸ“ åœ°é» Location</label>
                                <input type="text" value="${row.location}" onchange="update(${i}, 'location', this.value)" class="bg-transparent border-none text-3xl font-black text-emerald-900 focus:ring-0">
                            </div>
                        </div>
                    </td>
                </tr>`).join('');
            calc();
        }

        function update(i, col, val) {
            rowData[i][col] = val;
            if (col === 'orderTime' && val.includes(':')) {
                let [h, m] = val.split(':').map(Number);
                let sm = m + 5;
                rowData[i].startTime = `${String(h + Math.floor(sm/60)).padStart(2,'0')}:${String(sm%60).padStart(2,'0')}:00`;
                if(!rowData[i].endTime) rowData[i].endTime = `${String(h+1).padStart(2,'0')}:${String(sm%60).padStart(2,'0')}:00`;
                renderTable();
            }
            calc();
        }

        function calc() {
            let total = 0;
            rowData.forEach(r => {
                if(r.startTime && r.endTime) {
                    let s = new Date('2000/01/01 ' + r.startTime).getTime();
                    let e = new Date('2000/01/01 ' + r.endTime).getTime();
                    if(e > s) total += (e - s) / 3600000;
                }
            });
            const disp = document.getElementById('totalHours');
            disp.innerText = total.toFixed(1);
            disp.className = total >= 7 ? "text-6xl font-black text-emerald-600" : "text-6xl font-black text-rose-600";
        }

        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (Speech) {
            const rec = new Speech();
            rec.lang = 'zh-HK'; rec.interimResults = true;
            let isRec = false;

            document.getElementById('micBtn').onclick = () => { if (isRec) rec.stop(); else rec.start(); };
            rec.onstart = () => { isRec = true; document.getElementById('micBtn').classList.add('recording-active'); document.getElementById('micIcon').innerText = "ğŸ›‘"; };
            rec.onresult = (e) => {
                let t = Array.from(e.results).map(r => r[0].transcript).join('');
                document.getElementById('rawDisplay').innerText = t;
                let r = rowData[rowData.length - 1];
                STAR_MAP.forEach(item => { if(t.includes(item.key)) { r.location = item.loc; r.dept = item.dept; } });
                const tm = t.match(/(\d{1,2})[:é»](\d{1,2}|åŠ)/);
                if(tm) update(rowData.length - 1, 'orderTime', `${tm[1].padStart(2,'0')}:${tm[2]==='åŠ'?'30':tm[2].padStart(2,'0')}`);
                const dur = t.match(/(ä¸€å€‹åŠ|ä¸€|å…©|åŠ)\s*(å€‹åŠå°æ™‚|å°æ™‚|ç²’é˜|å€‹é˜)/);
                if(dur && r.startTime) {
                    let m = dur[1]==='ä¸€å€‹åŠ'?90:(dur[1]==='åŠ'?30:(dur[1]==='å…©'?120:60));
                    let [sh, sm] = r.startTime.split(':').map(Number);
                    let totalM = sm + m;
                    r.endTime = `${String(sh + Math.floor(totalM/60)).padStart(2,'0')}:${String(totalM%60).padStart(2,'0')}:00`;
                }
                const job = t.match(/(å…§å®¹ä¿‚|å…§å®¹å°±ä¿‚|å»|åš|è£|æ›|ç¶­ä¿®)\s*([\u4e00-\u9fa5\w]{2,15})/);
                if(job) r.content = job[2];
                renderTable();
            };
            rec.onend = () => { isRec = false; document.getElementById('micBtn').classList.remove('recording-active'); document.getElementById('micIcon').innerText = "ğŸ¤"; };
        }

        function copyToExcel() {
            const cols = ["id", "date", "group", "empId", "name", "shift", "woNo", "dept", "type", "content", "location", "orderTime", "startTime", "endTime", "status", "ot", "responseTime", "resTime"];
            let t = rowData.map(r => cols.map(c => r[c] || "").join("\t")).join("\n");
            navigator.clipboard.writeText(t).then(() => alert("âœ… 18 æ¬„ä½å·²æˆåŠŸè¤‡è£½ï¼\nè«‹åˆ‡æ›åˆ° Excel æŒ‰ Ctrl+V è²¼ä¸Šã€‚"));
        }
        function addNewRow() { rowData.push({...rowData[rowData.length-1], id: rowData.length+1, content:"", location:"", orderTime:"", startTime:"", endTime:""}); renderTable(); }
        function deleteRow(i) { if(confirm("ç¢ºå®šåˆªé™¤æ­¤è¡Œï¼Ÿ")) { rowData.splice(i,1); renderTable(); } }
        renderTable();
    </script>
</body>
</html>
