<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å ±å·¥åŠ©æ‰‹ v2.0 - å»£æ±è©±æ™ºèƒ½ç‰ˆ</title>
    <style>
        /* ==========================================
           Design System - CSS Variables
           ========================================== */
        :root {
            /* Colors */
            --color-primary: #2563eb;
            --color-primary-dark: #1d4ed8;
            --color-danger: #dc2626;
            --color-success: #059669;
            --color-warning: #d97706;
            --color-bg: #f1f5f9;
            --color-card: #ffffff;
            --color-border: #e2e8f0;
            --color-text: #1e293b;
            --color-text-muted: #64748b;
            --color-text-light: #94a3b8;
            
            /* Spacing Scale */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            
            /* Typography */
            --text-xs: 12px;
            --text-sm: 14px;
            --text-base: 16px;
            --text-lg: 18px;
            --text-xl: 20px;
            --text-2xl: 24px;
            --text-3xl: 30px;
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        /* ==========================================
           Reset & Base
           ========================================== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: "Microsoft JhengHei", "Heiti TC", "Segoe UI", sans-serif; 
            background-color: var(--color-bg); 
            font-size: var(--text-base);
            line-height: 1.6;
            color: var(--color-text);
        }

        /* ==========================================
           Layout System
           ========================================== */
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: var(--space-4); 
        }
        
        .grid { display: flex; flex-wrap: wrap; margin: 0 calc(-1 * var(--space-2)); }
        .col { padding: 0 var(--space-2); }
        .col-3 { width: 25%; }
        .col-9 { width: 75%; }
        
        /* éŸ¿æ‡‰å¼ï¼šå°è¢å¹•æ™‚å †ç–Š */
        @media (max-width: 1024px) {
            .col-3, .col-9 { width: 100%; }
        }

        /* ==========================================
           Components - Card
           ========================================== */
        .card { 
            background: var(--color-card); 
            border-radius: var(--radius-xl); 
            border: 1px solid var(--color-border); 
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-4);
            overflow: hidden;
        }
        
        .card-header { 
            padding: var(--space-4); 
            background: #f8fafc; 
            border-bottom: 1px solid var(--color-border);
            font-weight: bold;
            color: var(--color-text);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body { padding: var(--space-4); }
        .card-accent { border-top: 4px solid var(--color-primary); }

        /* ==========================================
           Components - Button
           ========================================== */
        .btn { 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-2) var(--space-4); 
            border-radius: var(--radius-md); 
            border: none; 
            cursor: pointer; 
            font-size: var(--text-base);
            font-weight: bold;
            transition: all 0.2s;
            text-align: center;
            gap: var(--space-2);
        }
        
        .btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn:active { transform: translateY(0); }
        
        .btn-primary { background: var(--color-primary); color: white; }
        .btn-primary:hover { background: var(--color-primary-dark); }
        
        .btn-danger { background: var(--color-danger); color: white; }
        .btn-success { background: var(--color-success); color: white; }
        .btn-warning { background: var(--color-warning); color: white; }
        
        .btn-lg { padding: var(--space-4) var(--space-6); font-size: var(--text-xl); }
        .btn-sm { padding: var(--space-1) var(--space-3); font-size: var(--text-sm); }
        .btn-block { display: flex; width: 100%; }
        
        .btn-mic { 
            width: 80px; 
            height: 80px; 
            border-radius: var(--radius-full); 
            font-size: var(--text-3xl);
            padding: 0;
        }

        /* ==========================================
           Components - Form
           ========================================== */
        .form-group { margin-bottom: var(--space-4); }
        
        .form-label { 
            display: block; 
            font-weight: bold; 
            color: var(--color-primary);
            margin-bottom: var(--space-2);
            font-size: var(--text-sm);
        }
        
        .form-control { 
            width: 100%; 
            padding: var(--space-2) var(--space-3); 
            border: 2px solid #cbd5e1; 
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .form-control:focus { 
            border-color: var(--color-primary); 
            outline: none; 
            background: #fff;
        }
        
        .input-display { 
            min-height: 100px; 
            background: #f8fafc; 
            border: 2px dashed #cbd5e1;
            padding: var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--text-lg);
            line-height: 1.5;
        }
        
        .input-hint { 
            font-size: var(--text-xs); 
            color: var(--color-text-light); 
            margin-top: var(--space-2);
        }

        /* ==========================================
           Components - Table
           ========================================== */
        .table-container { overflow-x: auto; }
        
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: var(--text-sm);
        }
        
        .data-table th { 
            padding: var(--space-3); 
            text-align: left; 
            background: #f1f5f9;
            font-weight: bold;
            color: var(--color-text-muted);
            font-size: var(--text-xs);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }
        
        .data-table td { 
            padding: var(--space-2); 
            border-bottom: 1px solid var(--color-border);
            vertical-align: top;
        }
        
        .data-table tr:hover { background: #f8fafc; }
        
        .table-input { 
            width: 100%; 
            border: 1px solid #cbd5e1; 
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
            font-family: inherit;
        }
        
        .table-input:focus { 
            border-color: var(--color-primary); 
            outline: none;
        }
        
        .table-input-highlight { background: #fffbeb; }
        
        .cell-hours { 
            font-weight: bold; 
            color: var(--color-primary);
            text-align: center;
        }

        /* ==========================================
           Components - Alert & Feedback
           ========================================== */
        .alert { 
            padding: var(--space-3) var(--space-4); 
            border-radius: var(--radius-md); 
            margin-bottom: var(--space-4);
            display: none;
            border-left: 4px solid;
        }
        
        .alert-success { 
            background: #d1fae5; 
            color: #065f46; 
            border-color: var(--color-success);
        }
        
        .alert-error { 
            background: #fee2e2; 
            color: #991b1b; 
            border-color: var(--color-danger);
        }
        
        .alert-warning { 
            background: #fef3c7; 
            color: #92400e; 
            border-color: var(--color-warning);
        }

        .parse-feedback { 
            background: #eff6ff; 
            border-left: 4px solid var(--color-primary); 
            padding: var(--space-3); 
            margin: var(--space-3) 0;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
        }
        
        .parse-item { 
            display: flex; 
            justify-content: space-between;
            padding: var(--space-1) 0;
            border-bottom: 1px dashed #dbeafe;
        }
        
        .parse-item:last-child { border-bottom: none; }
        .parse-label { color: var(--color-primary); font-weight: bold; }
        .parse-value { color: var(--color-text); }

        .multi-location-warning {
            background: #fff7ed;
            border: 2px solid #f97316;
            border-radius: var(--radius-md);
            padding: var(--space-3);
            margin: var(--space-3) 0;
            display: none;
        }

        /* ==========================================
           Components - Badge & Tag
           ========================================== */
        .badge { 
            display: inline-block; 
            padding: var(--space-1) var(--space-2); 
            border-radius: var(--radius-sm); 
            font-size: var(--text-xs); 
            font-weight: bold;
            margin-right: var(--space-2);
            margin-bottom: var(--space-2);
        }
        
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-amber { background: #fef3c7; color: #92400e; }
        .badge-green { background: #d1fae5; color: #065f46; }

        /* ==========================================
           Components - Stats
           ========================================== */
        .stats-box { 
            text-align: right; 
            padding: var(--space-4); 
            background: #fff1f2; 
            border-top: 2px solid #fda4af;
        }
        
        .stats-number { 
            font-size: var(--text-3xl); 
            color: #e11d48; 
            font-weight: bold;
        }
        
        .stats-label { 
            font-size: var(--text-sm); 
            color: var(--color-text-muted);
        }

        /* ==========================================
           Utilities
           ========================================== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-muted { color: var(--color-text-muted); }
        .text-sm { font-size: var(--text-sm); }
        .text-xs { font-size: var(--text-xs); }
        .font-bold { font-weight: bold; }
        
        .mb-1 { margin-bottom: var(--space-1); }
        .mb-2 { margin-bottom: var(--space-2); }
        .mb-3 { margin-bottom: var(--space-3); }
        .mb-4 { margin-bottom: var(--space-4); }
        
        .mr-2 { margin-right: var(--space-2); }
        
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: var(--space-2); }
        .gap-3 { gap: var(--space-3); }
        .gap-4 { gap: var(--space-4); }
        
        .hidden { display: none; }
        
        /* éŒ„éŸ³å‹•ç•« */
        .recording { 
            animation: pulse 1.5s infinite; 
            background: var(--color-danger) !important; 
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        /* æŒ‡å—å€åŸŸç‰¹æ®Šæ¨£å¼ */
        .guide-step { margin-bottom: var(--space-4); }
        .guide-step-title { 
            font-weight: bold; 
            color: var(--color-primary);
            margin-bottom: var(--space-1);
        }
        .guide-step-desc { color: var(--color-text-muted); font-size: var(--text-sm); }
        
        .location-tags { margin-top: var(--space-3); }
        
        .security-info {
            background: #f8fafc;
            padding: var(--space-3);
            border-radius: var(--radius-md);
            margin-top: var(--space-4);
            font-size: var(--text-xs);
            color: var(--color-text-muted);
        }

        /* åˆ†éš”ç·š */
        .divider {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: var(--space-4) 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æç¤ºè¨Šæ¯å€åŸŸ -->
        <div id="alertBox" class="alert" role="alert"></div>
        
        <div class="grid">
            <!-- å·¦å´ï¼šä½¿ç”¨æŒ‡å— -->
            <div class="col col-3">
                <div class="card card-accent">
                    <div class="card-header">
                        <span>ğŸ“– ä½¿ç”¨æŒ‡å— (v2.0)</span>
                    </div>
                    <div class="card-body">
                        <div class="guide-step">
                            <div class="guide-step-title">Step 1: éŒ„éŸ³</div>
                            <div class="guide-step-desc">æ’³ğŸ¤æ£é–‹å§‹è¬›å˜¢ã€‚ä¾‹å¦‚ï¼šã€Œåé»ä¸‰å»é¢¨å‘³å±…æ•´å†·æ°£åšå·¦å…©å€‹é˜ã€</div>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-title">Step 2: ä¿®æ­£</div>
                            <div class="guide-step-desc">å–ºå³é‚Šæ¡†å…§æª¢æŸ¥æ–‡å­—ï¼Œæœ‰éŒ¯å­—ç›´æ¥æ‰‹æ‰“æ”¹è¿”ä½¢ã€‚</div>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-title">Step 3: åŸ·è¡Œåˆ†æ</div>
                            <div class="guide-step-desc">æ’³ <span class="badge badge-blue">åˆ†æä¸¦å¡«è¡¨</span>ï¼ŒAI æœƒè‡ªå‹•å¡«å…¥ä¸‹æ–¹è¡¨æ ¼ã€‚</div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="security-info">
                            <div class="font-bold mb-2">ğŸ”’ å®‰å…¨ç‰¹æ€§ï¼š</div>
                            <ul style="padding-left: 16px; margin: 0;">
                                <li>âŒ ç„¡æœ¬åœ°å„²å­˜ - é—œé–‰å³æ¸…é™¤</li>
                                <li>âŒ ç„¡ç¶²è·¯è«‹æ±‚ - ç´”æœ¬åœ°é‹ä½œ</li>
                                <li>âœ… ç›¸å®¹èˆŠç‰ˆç€è¦½å™¨</li>
                                <li>âœ… å»£æ±è©±æ™‚é–“æ™ºèƒ½è§£æ</li>
                            </ul>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div>
                            <div class="font-bold mb-2">æ˜Ÿéš›ç†±é–€åœ°é»ï¼š</div>
                            <div class="location-tags">
                                <span class="badge badge-blue">Passion (G/F)</span>
                                <span class="badge badge-blue">ç¿ è¯ (1/F)</span>
                                <span class="badge badge-blue">å”æˆ (10/F)</span>
                                <span class="badge badge-blue">æ³³æ±  (17/F)</span>
                                <span class="badge badge-blue">é¢¨å‘³å±… (5/F)</span>
                                <span class="badge badge-blue">å¯«å­—æ¨“ (16/F)</span>
                            </div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="text-xs text-muted">
                            <div class="font-bold mb-1">æ™‚é–“æ ¼å¼æ”¯æ´ï¼š</div>
                            <div>â€¢ åé»ä¸‰ = 10:15</div>
                            <div>â€¢ åé»åŠ = 10:30</div>
                            <div>â€¢ åé»ä¹ = 10:45</div>
                            <div>â€¢ 1030, 10:30, 10é»30åˆ†</div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center text-muted text-sm" style="padding: var(--space-4);">
                    <em>Secure Cantonese AI v2.0</em>
                </div>
            </div>

            <!-- å³å´ï¼šä¸»è¦åŠŸèƒ½å€ -->
            <div class="col col-9">
                <!-- è¼¸å…¥å€åŸŸ -->
                <div class="card">
                    <div class="card-body">
                        <div class="flex gap-4" style="align-items: flex-start;">
                            <!-- éŒ„éŸ³æŒ‰éˆ• -->
                            <div class="text-center">
                                <button id="micBtn" class="btn btn-primary btn-mic" title="é–‹å§‹/åœæ­¢éŒ„éŸ³">
                                    <span id="micIcon">ğŸ¤</span>
                                </button>
                                <div id="micStatus" class="text-sm text-muted" style="margin-top: var(--space-2);">æ’³ä¸€ä¸‹éŒ„éŸ³</div>
                                <div id="browserSupport" class="text-xs text-muted" style="margin-top: var(--space-1);"></div>
                            </div>
                            
                            <!-- æ–‡å­—è¼¸å…¥å€ -->
                            <div style="flex: 1;">
                                <div class="flex justify-between mb-2">
                                    <label class="form-label">ğŸ”Š èªéŸ³åŸæ–‡ / æ‰‹å‹•è¼¸å…¥å€ï¼š</label>
                                    <button onclick="parseAndFill()" class="btn btn-primary">
                                        <span>ğŸš€</span>
                                        <span>åˆ†æä¸¦å¡«è¡¨</span>
                                    </button>
                                </div>
                                <div id="inputDisplay" class="input-display" contenteditable="true">
                                    è«‹èªªè©±æˆ–è¼¸å…¥å…§å®¹...
                                </div>
                                <div class="input-hint">
                                    æ”¯æ´å»£æ±è©±å£èªï¼šã€Œåé»ä¸‰å»é¢¨å‘³å±…æ•´å†·æ°£åšå·¦å…©å€‹é˜ã€æˆ–ã€Œ14:30 æ³³æ± æª¢æŸ¥æ°´è³ª 1.5å°æ™‚ã€
                                </div>
                            </div>
                        </div>
                        
                        <!-- å¤šåœ°é»è­¦å‘Š -->
                        <div id="multiLocationWarning" class="multi-location-warning">
                            <div class="flex items-center gap-2 mb-2">
                                <span>âš ï¸</span>
                                <span class="font-bold">åµæ¸¬åˆ°å¤šå€‹åœ°é»</span>
                            </div>
                            <div id="detectedLocations" class="mb-2"></div>
                            <div class="text-sm">ç³»çµ±å·²ä½¿ç”¨ç¬¬ä¸€å€‹åœ°é»ã€‚å¦‚éœ€åˆ†é–‹è¨˜éŒ„ï¼Œè«‹æ‰‹å‹•æ–°å¢è¡Œã€‚</div>
                        </div>
                        
                        <!-- è§£æçµæœåé¥‹ -->
                        <div id="parseFeedback" class="parse-feedback hidden">
                            <div class="font-bold mb-2">ğŸ“ è§£æçµæœï¼š</div>
                            <div id="parseDetails"></div>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æ ¼å€åŸŸ -->
                <div class="card">
                    <div class="card-header">
                        <span>å·¥å–®è¨˜éŒ„è¡¨</span>
                        <button onclick="addNewRow()" class="btn btn-primary btn-sm">
                            <span>â•</span>
                            <span>æ–°å¢ç©ºç™½è¡Œ</span>
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="workTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>æ—¥æœŸ</th>
                                    <th>çµ„åˆ¥</th>
                                    <th>å“¡å·¥ID</th>
                                    <th>å§“å</th>
                                    <th>ç­æ¬¡</th>
                                    <th>å·¥å–®è™Ÿ</th>
                                    <th>éƒ¨é–€</th>
                                    <th>é¡å‹</th>
                                    <th>å·¥ä½œå…§å®¹</th>
                                    <th>åœ°é»</th>
                                    <th>ä¸‹å–®æ™‚é–“</th>
                                    <th>é–‹å§‹æ™‚é–“</th>
                                    <th>çµæŸæ™‚é–“</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>OT</th>
                                    <th>éŸ¿æ‡‰æ™‚é–“</th>
                                    <th>å·¥æ™‚</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- å‹•æ…‹ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                    <div class="stats-box">
                        <span class="stats-label">ç¸½å·¥æ™‚ï¼š</span>
                        <span id="totalHours" class="stats-number">0.0</span>
                        <span class="stats-label">å°æ™‚</span>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <button onclick="copyToClipboard()" class="btn btn-success btn-lg btn-block">
                    <span>ğŸ“‹</span>
                    <span>è¤‡è£½å…¨éƒ¨è³‡æ–™ (è²¼å…¥ Excel)</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // é…ç½®èˆ‡è³‡æ–™
        // ==========================================
        
        // åœ°é»å°æ‡‰è¡¨
        var LOCATION_MAP = [
            { keywords: ['Passion', 'passion'], location: 'Passion', dept: 'F&B', full: 'G/F Passion' },
            { keywords: ['ç¿ è¯'], location: '1/F ç¿ è¯é¤å»³', dept: 'F&B', full: '1/F ç¿ è¯é¤å»³' },
            { keywords: ['æœ‰é£Ÿè¾°'], location: '1/F æœ‰é£Ÿè¾°', dept: 'F&B', full: '1/F æœ‰é£Ÿè¾°' },
            { keywords: ['çå‘³è»’', 'çå‘³'], location: '1/F çå‘³è»’', dept: 'F&B', full: '1/F çå‘³è»’' },
            { keywords: ['ä¸¹æ¡‚', 'ä¸¹æ¡‚è»’'], location: '2/F ä¸¹æ¡‚è»’', dept: 'F&B', full: '2/F ä¸¹æ¡‚è»’' },
            { keywords: ['çæ·®', 'çæ·®é–£'], location: '3/F çæ·®é–£', dept: 'F&B', full: '3/F çæ·®é–£' },
            { keywords: ['é•·å‹', 'é•·å‹åŠ'], location: '3/F é•·å‹åŠ', dept: 'F&B', full: '3/F é•·å‹åŠ' },
            { keywords: ['é¢¨å‘³', 'é¢¨å‘³å±…'], location: '5/F é¢¨å‘³å±…', dept: 'F&B', full: '5/F é¢¨å‘³å±…' },
            { keywords: ['å¤©å³°', 'å¤©å³°è»’'], location: '6/F å¤©å³°è»’', dept: 'F&B', full: '6/F å¤©å³°è»’' },
            { keywords: ['å”æˆ', 'ç«é‹'], location: '10/F å”æˆç«é‹', dept: 'F&B', full: '10/F å”æˆç«é‹' },
            { keywords: ['å“å‘³å§', 'é…’å§'], location: '16/F å“å‘³å§', dept: 'F&B', full: '16/F å“å‘³å§' },
            { keywords: ['æ³³æ± ', 'å¥èº«'], location: '17/F æ³³æ± åŠå¥èº«ä¸­å¿ƒ', dept: 'Leisure', full: '17/F æ³³æ± åŠå¥èº«ä¸­å¿ƒ' },
            { keywords: ['å¯«å­—æ¨“', 'è¾¦å…¬å®¤', 'å·¥ç¨‹éƒ¨'], location: '16/F å·¥ç¨‹éƒ¨è¾¦å…¬å®¤', dept: 'å·¥ç¨‹', full: '16/F å·¥ç¨‹éƒ¨è¾¦å…¬å®¤' }
        ];
        
        // è³‡æ–™å„²å­˜ï¼ˆåƒ…è¨˜æ†¶é«”ï¼Œç„¡æŒä¹…åŒ–ï¼‰
        var workData = [];
        var nextId = 1;
        var isRecording = false;
        var recognition = null;
        
        // é è¨­å“¡å·¥è³‡è¨Š
        var DEFAULT_EMPLOYEE = {
            group: 'BD',
            empId: '7620',
            name: 'å ¯',
            shift: '08:45:00'
        };
        
        // ==========================================
        // å·¥å…·å‡½æ•¸
        // ==========================================
        
        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.appendChild(document.createTextNode(text));
            return div.innerHTML;
        }
        
        function showAlert(message, type) {
            var alertBox = document.getElementById('alertBox');
            alertBox.className = 'alert alert-' + type;
            alertBox.innerHTML = message;
            alertBox.style.display = 'block';
            
            setTimeout(function() {
                alertBox.style.display = 'none';
            }, 5000);
        }
        
        function getTodayDate() {
            var now = new Date();
            var year = now.getFullYear();
            var month = String(now.getMonth() + 1).padStart(2, '0');
            var day = String(now.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }
        
        // ==========================================
        // å»£æ±è©±æ™‚é–“è§£æï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
        // ==========================================
        
        /**
         * è§£æå»£æ±è©±å£èªæ™‚é–“
         * æ”¯æ´æ ¼å¼ï¼š
         * - åé»ä¸‰ = 10:15ï¼ˆä¸‰å€‹å­—ï¼Œæ¯å­—5åˆ†é˜ï¼‰
         * - åé»ä¹ = 10:45ï¼ˆä¹å€‹å­—ï¼‰
         * - åé»åŠ = 10:30
         * - åé»æ­£ = 10:00
         * - åé» = 10:00
         * - 10:30, 1030ï¼ˆé˜¿æ‹‰ä¼¯æ•¸å­—ï¼‰
         */
        function parseCantoneseTime(timeStr) {
            if (!timeStr) return '';
            
            timeStr = timeStr.trim().replace(/\s/g, '');
            
            // é˜¿æ‹‰ä¼¯æ•¸å­—æ ¼å¼ï¼š10:30 æˆ– 1030
            var arabicMatch = timeStr.match(/^(\d{1,2})[:ï¼š]?(\d{2})$/);
            if (arabicMatch) {
                var hour = parseInt(arabicMatch[1], 10);
                var minute = parseInt(arabicMatch[2], 10);
                if (hour >= 0 && hour < 24 && minute >= 0 && minute < 60) {
                    return formatTimeString(hour, minute);
                }
            }
            
            // ä¸­æ–‡æ•¸å­—æ˜ å°„
            var cnNums = {
                'ä¸€': 1, 'äºŒ': 2, 'å…©': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5,
                'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9, 'å': 10,
                'åä¸€': 11, 'åäºŒ': 12, '1': 1, '2': 2, '3': 3, '4': 4,
                '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
                '11': 11, '12': 12
            };
            
            // å»£æ±è©±å£èªæ ¼å¼
            // åŒ¹é…ï¼šåé»ä¸‰ã€åé»åŠã€åé»æ­£ã€åé»ã€10é»3
            var patterns = [
                /([ä¸€äºŒå…©ä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]{1,2})[é»:]([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]|åŠ|æ­£)/,
                /([ä¸€äºŒå…©ä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]{1,2})[é»:](\d{1,2})/
            ];
            
            for (var i = 0; i < patterns.length; i++) {
                var match = timeStr.match(patterns[i]);
                if (match) {
                    var hourStr = match[1];
                    var minuteStr = match[2];
                    
                    var hour = cnNums[hourStr] || parseInt(hourStr, 10);
                    if (!hour || hour < 0 || hour > 23) continue;
                    
                    var minute = 0;
                    
                    // è™•ç†åˆ†é˜éƒ¨åˆ†
                    if (minuteStr === 'åŠ') {
                        minute = 30;
                    } else if (minuteStr === 'æ­£' || !minuteStr) {
                        minute = 0;
                    } else if (cnNums[minuteStr]) {
                        // ä¸­æ–‡æ•¸å­—ï¼ˆä¸€-ä¹ï¼‰
                        var num = cnNums[minuteStr];
                        if (num >= 1 && num <= 12) {
                            // å‡è¨­ä¿‚ã€Œå­—ã€ï¼ˆ5åˆ†é˜ä¸€æ ¼ï¼‰
                            minute = num * 5;
                            // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœè¶…é 59ï¼Œç•¶ä½œæ™®é€šåˆ†é˜
                            if (minute > 59) minute = num;
                        } else {
                            minute = num;
                        }
                    } else {
                        // é˜¿æ‹‰ä¼¯æ•¸å­—
                        minute = parseInt(minuteStr, 10);
                    }
                    
                    if (minute >= 0 && minute < 60) {
                        return formatTimeString(hour, minute);
                    }
                }
            }
            
            return '';
        }
        
        function formatTimeString(hour, minute) {
            return String(hour).padStart(2, '0') + ':' + 
                   String(minute).padStart(2, '0') + ':00';
        }
        
        // ==========================================
        // æŒçºŒæ™‚é–“è§£æ
        // ==========================================
        
        function parseDuration(text) {
            // åŒ¹é…æ¨¡å¼ï¼šå…©å€‹é˜, 2å°æ™‚, 1.5å°æ™‚, 90åˆ†é˜, ä¸€å€‹åŠå°æ™‚, åŠå€‹é˜
            var patterns = [
                { regex: /(\d+\.?\d*)\s*(å°æ™‚|hr|h|å€‹é˜|ç²’é˜)/, multiplier: 60 },
                { regex: /(ä¸€å€‹åŠ|åŠ|ä¸€|å…©|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å)\s*(å€‹åŠå°æ™‚|å€‹é˜|ç²’é˜|å°æ™‚)/, multiplier: 60 },
                { regex: /(\d+)\s*åˆ†é˜?/, multiplier: 1 }
            ];
            
            var timeMap = {
                'ä¸€å€‹åŠ': 90, 'åŠ': 30, 'ä¸€': 60, 'å…©': 120, 'äºŒ': 120,
                'ä¸‰': 180, 'å››': 240, 'äº”': 300, 'å…­': 360, 'ä¸ƒ': 420,
                'å…«': 480, 'ä¹': 540, 'å': 600
            };
            
            for (var i = 0; i < patterns.length; i++) {
                var match = text.match(patterns[i].regex);
                if (match) {
                    var val = match[1];
                    if (!isNaN(parseFloat(val))) {
                        return Math.round(parseFloat(val) * patterns[i].multiplier);
                    }
                    if (timeMap[val]) {
                        return timeMap[val];
                    }
                }
            }
            return 0;
        }
        
        // ==========================================
        // æ ¸å¿ƒè§£æé‚è¼¯
        // ==========================================
        
        function parseInputText(text) {
            var result = {
                locations: [],      // æ”¹ç‚ºé™£åˆ—ï¼Œæ”¯æ´å¤šåœ°é»
                primaryLocation: null,
                department: '',
                orderTime: '',
                duration: 0,
                content: '',
                parsedItems: [],
                warnings: []
            };
            
            if (!text || text.trim() === '' || text === 'è«‹èªªè©±æˆ–è¼¸å…¥å…§å®¹...') {
                return result;
            }
            
            text = text.trim();
            
            // 1. è§£ææ‰€æœ‰åœ°é»ï¼ˆå””å† breakï¼‰
            for (var i = 0; i < LOCATION_MAP.length; i++) {
                var loc = LOCATION_MAP[i];
                for (var j = 0; j < loc.keywords.length; j++) {
                    if (text.indexOf(loc.keywords[j]) !== -1) {
                        // æª¢æŸ¥ä¿‚å’ªå·²ç¶“åŠ é
                        var alreadyAdded = false;
                        for (var k = 0; k < result.locations.length; k++) {
                            if (result.locations[k].location === loc.location) {
                                alreadyAdded = true;
                                break;
                            }
                        }
                        
                        if (!alreadyAdded) {
                            result.locations.push({
                                keyword: loc.keywords[j],
                                location: loc.location,
                                dept: loc.dept,
                                full: loc.full
                            });
                        }
                        break;
                    }
                }
            }
            
            // è¨­å®šä¸»è¦åœ°é»ï¼ˆç¬¬ä¸€å€‹ï¼‰
            if (result.locations.length > 0) {
                result.primaryLocation = result.locations[0];
                result.department = result.primaryLocation.dept;
                result.parsedItems.push({
                    label: 'åœ°é»',
                    value: result.primaryLocation.full + (result.locations.length > 1 ? ' (+' + (result.locations.length - 1) + 'å€‹)' : '')
                });
            } else {
                result.department = 'å·¥ç¨‹';
                result.parsedItems.push({ label: 'éƒ¨é–€', value: 'å·¥ç¨‹ (é è¨­)' });
            }
            
            // å¤šåœ°é»è­¦å‘Š
            if (result.locations.length > 1) {
                result.warnings.push('åµæ¸¬åˆ° ' + result.locations.length + ' å€‹åœ°é»ï¼š' + 
                    result.locations.map(function(l) { return l.full; }).join('ã€'));
            }
            
            // 2. è§£ææ™‚é–“ï¼ˆæµæ‰€æœ‰å¯èƒ½å˜…æ™‚é–“ï¼Œå–ç¬¬ä¸€å€‹ä½œç‚ºä¸‹å–®æ™‚é–“ï¼‰
            var timeMatches = text.match(/(\d{1,2})[:é»\s](\d{1,2}|[åŠæ­£ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å])|[ä¸€äºŒå…©ä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,2}[é»:]([åŠæ­£ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]|\d{1,2})/g);
            
            if (timeMatches && timeMatches.length > 0) {
                result.orderTime = parseCantoneseTime(timeMatches[0]);
                if (result.orderTime) {
                    result.parsedItems.push({ label: 'ä¸‹å–®æ™‚é–“', value: result.orderTime });
                }
            }
            
            // 3. è§£ææŒçºŒæ™‚é–“
            result.duration = parseDuration(text);
            if (result.duration > 0) {
                var hours = Math.floor(result.duration / 60);
                var mins = result.duration % 60;
                var timeStr = hours > 0 ? hours + 'å°æ™‚' : '';
                if (mins > 0) timeStr += mins + 'åˆ†é˜';
                result.parsedItems.push({ label: 'å·¥ä½œæ™‚é•·', value: timeStr });
            }
            
            // 4. è§£æå·¥ä½œå…§å®¹
            var contentPatterns = [
                /(?:åš|æ•´|ä¿®|æª¢æŸ¥|è™•ç†|å®‰è£|æ›´æ›|æ¸…æ½”|ç¶­ä¿®)\s*([\u4e00-\u9fa5\w]{2,10})/,
                /(?:é—œæ–¼|æœ‰é—œ)\s*([\u4e00-\u9fa5\w]{2,10})/,
                /([\u4e00-\u9fa5]{2,6})(?:å•é¡Œ|æ•…éšœ|ç¶­ä¿®|ä¿é¤Š)/
            ];
            
            for (var p = 0; p < contentPatterns.length; p++) {
                var contentMatch = text.match(contentPatterns[p]);
                if (contentMatch) {
                    var candidate = contentMatch[1];
                    // æ’é™¤åœ°é»é—œéµå­—
                    var isLocation = false;
                    for (var m = 0; m < LOCATION_MAP.length; m++) {
                        if (LOCATION_MAP[m].keywords.indexOf(candidate) !== -1) {
                            isLocation = true;
                            break;
                        }
                    }
                    if (!isLocation) {
                        result.content = candidate;
                        result.parsedItems.push({ label: 'å·¥ä½œå…§å®¹', value: candidate });
                        break;
                    }
                }
            }
            
            return result;
        }
        
        // ==========================================
        // è³‡æ–™å¡«å……é‚è¼¯
        // ==========================================
        
        function fillDataFromParse(parseResult) {
            // é¡¯ç¤ºå¤šåœ°é»è­¦å‘Š
            var warningDiv = document.getElementById('multiLocationWarning');
            var locationsDiv = document.getElementById('detectedLocations');
            
            if (parseResult.warnings.length > 0) {
                locationsDiv.innerHTML = parseResult.locations.map(function(l) {
                    return '<span class="badge badge-amber mr-2">' + escapeHtml(l.full) + '</span>';
                }).join('');
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }
            
            if (!parseResult.primaryLocation && !parseResult.orderTime && parseResult.duration === 0) {
                showAlert('æœªèƒ½å¾è¼¸å…¥ä¸­è­˜åˆ¥æœ‰æ•ˆè³‡è¨Šï¼Œè«‹æª¢æŸ¥æ ¼å¼æˆ–æ‰‹å‹•è¼¸å…¥', 'warning');
                return false;
            }
            
            // å»ºç«‹æ–°è¡Œæˆ–æ›´æ–°æœ€å¾Œä¸€è¡Œ
            var targetRow = null;
            var isNewRow = false;
            
            if (workData.length > 0) {
                var lastRow = workData[workData.length - 1];
                if (!lastRow.location && !lastRow.orderTime) {
                    targetRow = lastRow;
                }
            }
            
            if (!targetRow) {
                targetRow = createEmptyRow();
                workData.push(targetRow);
                isNewRow = true;
            }
            
            // å¡«å……è³‡æ–™
            if (parseResult.primaryLocation) {
                targetRow.location = parseResult.primaryLocation.location;
                targetRow.dept = parseResult.primaryLocation.dept;
            }
            if (parseResult.orderTime) targetRow.orderTime = parseResult.orderTime;
            if (parseResult.content) targetRow.content = parseResult.content;
            
            // è‡ªå‹•è¨ˆç®—é–‹å§‹å’ŒçµæŸæ™‚é–“
            if (parseResult.orderTime) {
                var orderMinutes = timeToMinutes(parseResult.orderTime);
                var startMinutes = orderMinutes + 5; // é è¨­5åˆ†é˜å¾Œé–‹å§‹
                targetRow.startTime = minutesToTime(startMinutes);
                
                if (parseResult.duration > 0) {
                    var endMinutes = startMinutes + parseResult.duration;
                    targetRow.endTime = minutesToTime(endMinutes);
                }
            }
            
            renderTable();
            showParseFeedback(parseResult);
            
            var msg = isNewRow ? 'å·²æ–°å¢æ–°è¨˜éŒ„' : 'å·²æ›´æ–°ç¾æœ‰è¨˜éŒ„';
            showAlert(msg + 'ï¼Œè«‹æª¢æŸ¥è¡¨æ ¼å…§å®¹æ˜¯å¦æ­£ç¢º', 'success');
            
            return true;
        }
        
        function showParseFeedback(parseResult) {
            var feedbackDiv = document.getElementById('parseFeedback');
            var detailsDiv = document.getElementById('parseDetails');
            
            if (parseResult.parsedItems.length === 0) {
                feedbackDiv.className = 'parse-feedback hidden';
                return;
            }
            
            var html = '';
            for (var i = 0; i < parseResult.parsedItems.length; i++) {
                var item = parseResult.parsedItems[i];
                html += '<div class="parse-item">';
                html += '<span class="parse-label">' + escapeHtml(item.label) + '</span>';
                html += '<span class="parse-value">' + escapeHtml(item.value) + '</span>';
                html += '</div>';
            }
            
            // é¡¯ç¤ºæœªè­˜åˆ¥çš„è­¦å‘Š
            var warnings = [];
            if (!parseResult.primaryLocation) warnings.push('åœ°é»');
            if (!parseResult.orderTime) warnings.push('æ™‚é–“');
            if (parseResult.duration === 0) warnings.push('æ™‚é•·');
            if (!parseResult.content) warnings.push('å·¥ä½œå…§å®¹');
            
            if (warnings.length > 0) {
                html += '<div style="margin-top: 8px; color: var(--color-warning); font-size: var(--text-sm);">';
                html += 'âš ï¸ æœªè­˜åˆ¥: ' + warnings.join(', ') + ' (è«‹æ‰‹å‹•å¡«å¯«)';
                html += '</div>';
            }
            
            detailsDiv.innerHTML = html;
            feedbackDiv.className = 'parse-feedback';
        }
        
        // ==========================================
        // è¡¨æ ¼æ“ä½œï¼ˆå„ªåŒ–ç‰ˆ - å±€éƒ¨æ›´æ–°ï¼‰
        // ==========================================
        
        function createEmptyRow() {
            return {
                id: nextId++,
                date: getTodayDate(),
                group: DEFAULT_EMPLOYEE.group,
                empId: DEFAULT_EMPLOYEE.empId,
                name: DEFAULT_EMPLOYEE.name,
                shift: DEFAULT_EMPLOYEE.shift,
                woNo: '',
                dept: '',
                type: 'CMBD',
                content: '',
                location: '',
                orderTime: '',
                startTime: '',
                endTime: '',
                status: 'å®Œæˆ',
                ot: 'No',
                responseTime: '00:05:00',
                resTime: ''
            };
        }
        
        function initData() {
            workData.push(createEmptyRow());
            renderTable();
        }
        
        // é¦–æ¬¡æ¸²æŸ“ï¼ˆå»ºç«‹ DOM çµæ§‹ï¼‰
        function renderTable() {
            var tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            for (var i = 0; i < workData.length; i++) {
                var row = workData[i];
                var tr = document.createElement('tr');
                tr.id = 'row-' + i;
                
                // å»ºç«‹æ¯ä¸€å€‹ cell
                var cells = [
                    { key: 'id', width: '40px', editable: false },
                    { key: 'date', width: '100px' },
                    { key: 'group', width: '50px' },
                    { key: 'empId', width: '60px' },
                    { key: 'name', width: '50px' },
                    { key: 'shift', width: '80px' },
                    { key: 'woNo', width: '80px' },
                    { key: 'dept', width: '60px' },
                    { key: 'type', width: '60px' },
                    { key: 'content', width: '150px' },
                    { key: 'location', width: '150px' },
                    { key: 'orderTime', width: '80px', highlight: true },
                    { key: 'startTime', width: '80px' },
                    { key: 'endTime', width: '80px' },
                    { key: 'status', width: '50px' },
                    { key: 'ot', width: '40px' },
                    { key: 'responseTime', width: '80px' },
                    { key: 'hours', width: '50px', editable: false, isCalculated: true },
                    { key: 'action', width: '40px', editable: false, isAction: true }
                ];
                
                for (var c = 0; c < cells.length; c++) {
                    var cell = cells[c];
                    var td = document.createElement('td');
                    
                    if (cell.isAction) {
                        td.innerHTML = '<button onclick="deleteRow(' + i + ')" style="color: var(--color-danger); border: none; background: none; cursor: pointer;">ğŸ—‘ï¸</button>';
                    } else if (cell.isCalculated) {
                        var hours = calculateHours(row.startTime, row.endTime);
                        td.className = 'cell-hours';
                        td.innerHTML = '<span id="hours-' + i + '">' + hours.toFixed(1) + '</span>';
                    } else if (cell.editable !== false) {
                        var input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'table-input' + (cell.highlight ? ' table-input-highlight' : '');
                        input.style.width = cell.width;
                        input.value = row[cell.key] || '';
                        input.setAttribute('data-row', i);
                        input.setAttribute('data-col', cell.key);
                        
                        // ä½¿ç”¨ onchange é€²è¡Œå±€éƒ¨æ›´æ–°
                        input.onchange = function() {
                            var r = parseInt(this.getAttribute('data-row'), 10);
                            var col = this.getAttribute('data-col');
                            updateRowData(r, col, this.value);
                        };
                        
                        td.appendChild(input);
                    } else {
                        td.innerHTML = row[cell.key];
                    }
                    
                    tr.appendChild(td);
                }
                
                tbody.appendChild(tr);
            }
            
            calculateTotalHours();
        }
        
        // å±€éƒ¨æ›´æ–°ï¼šåªæ›´æ–°è³‡æ–™åŒå—å½±éŸ¿å˜…é¡¯ç¤º
        function updateRowData(index, field, value) {
            var oldValue = workData[index][field];
            workData[index][field] = value;
            
            // å¦‚æœä¿®æ”¹å’—æ™‚é–“ç›¸é—œæ¬„ä½ï¼Œæ›´æ–°å·¥æ™‚é¡¯ç¤º
            if (field === 'startTime' || field === 'endTime') {
                var hours = calculateHours(workData[index].startTime, workData[index].endTime);
                var hoursCell = document.getElementById('hours-' + index);
                if (hoursCell) {
                    hoursCell.innerText = hours.toFixed(1);
                }
                calculateTotalHours();
            }
            
            // å¦‚æœä¿®æ”¹å’—éƒ¨é–€ï¼Œå¯ä»¥åŠ å…¥è‡ªå‹•å®Œæˆé‚è¼¯ï¼ˆæœªä¾†æ“´å±•ï¼‰
        }
        
        function deleteRow(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™è¡Œè³‡æ–™å—ï¼Ÿ')) {
                workData.splice(index, 1);
                if (workData.length === 0) {
                    workData.push(createEmptyRow());
                }
                renderTable(); // çµæ§‹æ€§æ”¹è®Šéœ€è¦é‡ç¹ª
                showAlert('å·²åˆªé™¤è³‡æ–™', 'success');
            }
        }
        
        function addNewRow() {
            workData.push(createEmptyRow());
            renderTable();
            showAlert('å·²æ–°å¢ç©ºç™½è¡Œ', 'success');
        }
        
        // ==========================================
        // æ™‚é–“è¨ˆç®—å·¥å…·
        // ==========================================
        
        function timeToMinutes(timeStr) {
            if (!timeStr) return 0;
            var parts = timeStr.split(':');
            return parseInt(parts[0], 10) * 60 + parseInt(parts[1], 10);
        }
        
        function minutesToTime(minutes) {
            minutes = minutes % (24 * 60);
            if (minutes < 0) minutes += 24 * 60;
            
            var h = Math.floor(minutes / 60);
            var m = minutes % 60;
            return formatTimeString(h, m);
        }
        
        function calculateHours(start, end) {
            if (!start || !end) return 0;
            
            var s = timeToMinutes(start);
            var e = timeToMinutes(end);
            
            // è™•ç†è·¨åˆå¤œ
            if (e < s) {
                e += 24 * 60;
            }
            
            return (e - s) / 60;
        }
        
        function calculateTotalHours() {
            var total = 0;
            for (var i = 0; i < workData.length; i++) {
                total += calculateHours(workData[i].startTime, workData[i].endTime);
            }
            document.getElementById('totalHours').innerText = total.toFixed(1);
        }
        
        // ==========================================
        // èªéŸ³è¼¸å…¥
        // ==========================================
        
        function initSpeechRecognition() {
            var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            var supportMsg = document.getElementById('browserSupport');
            
            if (!SpeechRecognition) {
                supportMsg.innerHTML = 'âŒ ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥';
                document.getElementById('micBtn').style.display = 'none';
                return;
            }
            
            supportMsg.innerHTML = 'âœ… èªéŸ³è¼¸å…¥å°±ç·’';
            
            recognition = new SpeechRecognition();
            recognition.lang = 'zh-HK';
            recognition.continuous = true;
            recognition.interimResults = true;
            
            recognition.onstart = function() {
                isRecording = true;
                document.getElementById('micBtn').className = 'btn btn-danger btn-mic recording';
                document.getElementById('micIcon').innerText = 'â¹';
                document.getElementById('micStatus').innerText = 'éŒ„éŸ³ä¸­... (å†æ’³ä¸€ä¸‹åœæ­¢)';
            };
            
            recognition.onresult = function(event) {
                var transcript = '';
                for (var i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                document.getElementById('inputDisplay').innerText = transcript;
            };
            
            recognition.onerror = function(event) {
                console.error('èªéŸ³è¾¨è­˜éŒ¯èª¤:', event.error);
                showAlert('èªéŸ³è¾¨è­˜éŒ¯èª¤: ' + event.error, 'error');
                stopRecording();
            };
            
            recognition.onend = function() {
                stopRecording();
            };
            
            document.getElementById('micBtn').onclick = function() {
                if (isRecording) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            };
        }
        
        function stopRecording() {
            isRecording = false;
            document.getElementById('micBtn').className = 'btn btn-primary btn-mic';
            document.getElementById('micIcon').innerText = 'ğŸ¤';
            document.getElementById('micStatus').innerText = 'æ’³ä¸€ä¸‹éŒ„éŸ³';
        }
        
        // ==========================================
        // åŒ¯å‡ºåŠŸèƒ½
        // ==========================================
        
        function copyToClipboard() {
            if (workData.length === 0) {
                showAlert('æ²’æœ‰è³‡æ–™å¯å¤åˆ¶', 'warning');
                return;
            }
            
            var columns = ['id', 'date', 'group', 'empId', 'name', 'shift', 'woNo', 'dept', 'type', 'content', 'location', 'orderTime', 'startTime', 'endTime', 'status', 'ot', 'responseTime', 'resTime'];
            var lines = [];
            
            // æ¨™é¡Œåˆ—
            lines.push(columns.join('\t'));
            
            // è³‡æ–™åˆ—
            for (var i = 0; i < workData.length; i++) {
                var row = workData[i];
                var values = [];
                for (var j = 0; j < columns.length; j++) {
                    values.push(row[columns[j]] || '');
                }
                lines.push(values.join('\t'));
            }
            
            var textToCopy = lines.join('\n');
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textToCopy).then(function() {
                    showAlert('âœ… å·²æˆåŠŸè¤‡è£½ ' + workData.length + ' è¡Œè³‡æ–™åˆ°å‰ªè²¼ç°¿ï¼', 'success');
                }).catch(function(err) {
                    fallbackCopy(textToCopy);
                });
            } else {
                fallbackCopy(textToCopy);
            }
        }
        
        function fallbackCopy(text) {
            var textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                var successful = document.execCommand('copy');
                if (successful) {
                    showAlert('âœ… å·²æˆåŠŸè¤‡è£½ ' + workData.length + ' è¡Œè³‡æ–™åˆ°å‰ªè²¼ç°¿ï¼', 'success');
                } else {
                    showAlert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½', 'error');
                }
            } catch (err) {
                showAlert('âŒ ç€è¦½å™¨ä¸æ”¯æ´è‡ªå‹•è¤‡è£½', 'error');
            }
            
            document.body.removeChild(textarea);
        }
        
        // ==========================================
        // äº‹ä»¶è™•ç†
        // ==========================================
        
        function parseAndFill() {
            var text = document.getElementById('inputDisplay').innerText;
            var result = parseInputText(text);
            fillDataFromParse(result);
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            initData();
            initSpeechRecognition();
            
            var inputDisplay = document.getElementById('inputDisplay');
            inputDisplay.onclick = function() {
                if (this.innerText === 'è«‹èªªè©±æˆ–è¼¸å…¥å…§å®¹...') {
                    this.innerText = '';
                }
            };
        };
    </script>
</body>
</html>
